apply plugin: 'com.github.ethankhall.semantic-versioning'
apply plugin: 'com.github.kt3k.coveralls'
apply plugin: 'org.kordamp.gradle.stats'
apply plugin: 'me.champeau.gradle.jmh'
apply plugin: 'org.dm.bundle'
apply plugin: 'checkstyle'
apply plugin: 'findbugs'
apply plugin: 'eclipse'
apply plugin: 'jacoco'
apply plugin: 'pmd'

apply from: "${rootDir}/gradle/jmh.gradle"
apply from: "${rootDir}/gradle/code_quality.gradle"
apply from: "${rootDir}/gradle/dependencies.gradle"
apply from: "${rootDir}/gradle/object_layout.gradle"

apply from: "${projectDir}/cache_tests.gradle"

dependencies {
  compile libraries.jsr305

  testCompile libraries.guava
  testCompile test_libraries.awaitility
  testCompile test_libraries.guava_testlib
  testCompile test_libraries.testng

  jmh benchmark_libraries.jmh
  jmh benchmark_libraries.koloboke
  jmh benchmark_libraries.high_scale_lib
  jmh benchmark_libraries.concurrentlinkedhashmap
  jmh configurations.testCompile.allDependencies

  checkstyleConfig gradle_plugins.checkstyle
}

test {
  exclude 'com/github/benmanes/caffeine/cache/**'
}

tasks.withType(Test) {
  useTestNG()
  options {
    excludeGroups = ['slow']
    parallel = 'methods'
    threadCount = 6
  }
  if (name == 'slowTest') {
    maxHeapSize = '128m'
    testLogging.info.events 'passed'
  }
}

bundle {
  instruction 'Import-Package', 'sun.misc.*;resolution:=optional'
  instruction 'Export-Package', 'com.github.benmanes.caffeine.*'
}
